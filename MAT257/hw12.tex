\documentclass{article}
\usepackage[margin=1.0in]{geometry}
\usepackage{amssymb,amsmath,amsthm,amsfonts}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{mathtools}

% My boxes
\usepackage[breakable]{tcolorbox}

% \RequirePackage{background}
% \backgroundsetup{
%     scale=1,
%     color=black,
%     opacity=1,
%     angle=0,
%     contents={
%         \includegraphics[width=\paperwidth,height=\paperheight]{\nightmodebackground}
%     }
% }

\definecolor{pastelblue}{RGB}{96, 145, 245}
\definecolor{pastelgreen}{RGB}{106, 235, 135}
\definecolor{darkgray}{RGB}{60, 60, 60}
\definecolor{lightgray}{RGB}{180, 180, 180}
\definecolor{offwhite}{RGB}{225, 225, 245}


\pagecolor{darkgray}
\color{offwhite}

\newcommand{\Z}{\mathbf{Z}}
\newcommand{\N}{\mathbf{N}}
\newcommand{\R}{\mathbf{R}}
\newcommand{\Q}{\mathbf{Q}}
\newcommand{\C}{\mathbf{C}}

\newcommand{\id}{\mathrm{id}}
\newcommand{\op}{\mathrm{op}}
\newcommand{\diam}{\mathrm{diam}}
\newcommand{\GL}{\mathrm{GL}}
\newcommand{\Tr}{\mathrm{Tr}}
\newcommand{\im}{\mathrm{im}}
\newcommand{\rank}{\mathrm{rank}}

\newcommand{\cl}[1]{\overline{#1}}

\swapnumbers % places numbers before thm names

\theoremstyle{plain} % The "plain" style italicizes all body text.
	\newtheorem{thm}{Theorem}
		\numberwithin{thm}{section} % Theorem numbers are determined by section.
	\newtheorem{lemma}[thm]{Lemma}
	\newtheorem{prop}[thm]{Proposition}
	\newtheorem{cor}[thm]{Corollary}

\theoremstyle{definition}
    \newtheorem{defn}[thm]{Definition}
	\newtheorem{example}[thm]{Example}
	\newtheorem{exercise}[thm]{Exercise} %Exercise

\begin{document}
    \newtcolorbox{question}[2][]{fonttitle=\large, fontupper=\large, fontlower=\large, title=Question {#2}., oversize, arc=3mm, outer arc=2mm, opacityback=0.9, coltitle=offwhite, colframe=pastelblue, colback=darkgray, colupper=lightgray, collower=lightgray, leftrule=1mm, rightrule=1mm, toprule=1.5mm, titlerule=1mm, bottomrule=1mm, valign=center, add to natural height=5mm, lower separated=false, before lower=\begin{proof}, after lower= \smallbreak \end{proof}, #1, breakable=true}

    \begin{question}{32}
        Let $M$ be a subset of $\R^n$, let $p_0\in M$ be a point, and let $\vec{v}\in \R^n$ be a vector. We say that $\vec{v}$ is a \textbf{tangent vector} to $M$ at $p_0$ if there exists $\delta>0$ and a $C^1$ function $\alpha:(-\delta,\delta)\rightarrow M$ such that $\alpha(0)=p_0$ and $\alpha'(0)=\vec{v}$. In other words, $\vec{v}$ is the velocity vector of a curve through $M$.

        \begin{enumerate}[label=(\alph*)]
            \item Suppose now that $M$ is the \textit{zero set} of some $C^1$ function $f:U\rightarrow \R$, where $U$ is an open set in $\R^n$: thus
                \[ M = \{p\in U : f(p)=0\}. \]
            Suppose that $p_0\in M$ is a point such that $\nabla f(p_0)\neq \vec{0}$, and let $\vec{v}\in \R^n$ be a vector. Show that $\vec{v}$ is a tangent vector to $M$ at $p_0$ if and only if $\nabla f(p_0)\cdot \vec{v}=0$.

            \item Let $E$ be the ellipsoid in $\R^3$ defined by the following equation:
                \[ x^2 + yz + y^2 - xy - xz + z^2 = 3. \]
            Find the equation of the tangent plane to $M$ at the point $p_0=(1,2,3)$.

            \textcolor{blue}{Hint: Define an appropriate function $f$, then find two vectors which are orthogonal to $\nabla f(p_0)$. By (a), these two vectors span the tangent plane. I recommend using graphing software to confirm your result.}
        \end{enumerate}
        \tcblower
        (a):

        Suppose that \(\vec{v}\) is a tangent vector to \(M\) at \(p_0\). Then there exists a function \(\alpha : (-\delta , \delta ) \to M\) so that \(\alpha (0) = p_0\) and \(\alpha '(0) = \vec{v}\). Define \(g: (-\delta , \delta ) \to \mathbb{R}\) by \(g(t) = f(\alpha(t))\). For all \(t \in (-\delta ,\delta)\), \(\alpha (t) \in M\), so \(g(t) = 0\). It follows that
        \[
            0 = g'(t) = \nabla f(\alpha (t)) \cdot \alpha '(t)
        \]
        Substituting \(t = 0\) yields
        \[
            \nabla f(p_0) \cdot \vec{v} = 0
        \]
        as needed.

        \medskip

        Conversely, suppose that \(\nabla f(p_0) \cdot \vec{v} = 0\). Since \(\nabla f(p_0) \neq 0\), \(\dfrac{\partial f}{\partial x_i}(p_0) \neq 0\) for some \(i \in \{0, ..., n\}\). Define the \(C^1\) function \(g: \mathbb{R}^n \to \mathbb{R}\) as the function that swaps the \(i\)th and \(n\)th coordinate. That is,
        \[
            g(x_1, ..., x_n) = f(x_1, ..., x_{i-1}, x_n, x_{i+1}, ..., x_i)
        \]
        Let \(p'\) be the vector in \(\mathbb{R}^{n-1}\) whose components are the same as \(p_0\) except that its \(i\)th component is \(p_n\). In particular,
        \[
            p' = (p_1, ..., p_{i-1}, p_n, p_{i+1}, ..., p_{n-1}).
        \]
        Notice that \(\dfrac{\partial g}{\partial x_n}(p', p_i) = \dfrac{\partial f}{\partial x_i}(p_0) \neq 0\). Applying the Implicit Function Theorem with \(k = 1\), there exists an open set \(W \subseteq \mathbb{R}^{n-1}\) that contains \(p'\) and a continuously differentiable function \(\psi : W \to \mathbb{R}\) such that for all \(x' \in W\), \(\psi (p') = p_i\) and
        \[
            g(x', \psi(x')) = f(x_1, ..., x_{i-1} , \psi (x'), x_{i+1}, ..., x_{n-1}) = 0
        \]
        Since \(W\) is open, there exists \(\delta > 0\) so that for all \(\|t\| < \delta\), \(p' + t \pi _{\mathbb{R}^{n-1}}(\vec{v}) \in W\).

        Let \(\hat{v}\) be \(\vec{v}\) with swapped \(i\)th and \(n\)th components. Let \(\alpha : (-\delta ,\delta) \to M\) be defined by
        \[
            \alpha (t) = (p_1 + tv_1, ..., p_{i-1} + tv_{i-1}, \psi (p' + t v_i (\pi _{\mathbb{R}^{n-2}}(\hat{v}), -1)), p_{i+1} + tv_{i+1}, ..., p_n + tv_n).
        \]
        We can see that \(\alpha (0) = p_0\). Next, we want to show that \(\alpha '(0) = \vec{v}\). We first find the total derivative of \(\psi (p' + t v_i (\pi _{\mathbb{R}^{n-2}}(\hat{v}), -1))\). For \(j \in \{1, ..., n-1 \}\), we know that the \(j\)th partial derivative is given by
        \[
            \dfrac{\frac{\partial g}{\partial x_j}(p' + t v_i (\pi _{\mathbb{R}^{n-2}}(\hat{v}), -1)) \cdot v_i \cdot \hat{v}_j}{\frac{\partial g}{\partial x_n}(p' + t v_i (\pi _{\mathbb{R}^{n-2}}(\hat{v}), -1)) \cdot (-v_i)} = -\dfrac{\frac{\partial g}{\partial x_j}(p' + t v_i (\pi _{\mathbb{R}^{n-2}}(\hat{v}), -1)) \cdot \hat{v}_j}{\frac{\partial g}{\partial x_n}(p' + t v_i (\pi _{\mathbb{R}^{n-2}}(\hat{v}), -1))}
        \]
        substituting \(t=0\) into this expression gives us
        \[
            -\dfrac{\frac{\partial g}{\partial x_j}(p') \cdot \hat{v}_j}{\frac{\partial g}{\partial x_n}(p')} = -\dfrac{\frac{\partial g}{\partial x_j}(p') \cdot \hat{v}_j}{\frac{\partial f}{\partial x_i}(p_0)}
        \]
        For \(j \neq i\),
        \[
            -\dfrac{\frac{\partial g}{\partial x_j}(p') \cdot \hat{v}_j}{\frac{\partial f}{\partial x_i}(p_0)} = -\dfrac{\frac{\partial f}{\partial x_j}(p_0) \cdot v_j}{\frac{\partial f}{\partial x_i}(p_0)}.
        \]
        For \(j = i\),
        \[
            -\dfrac{\frac{\partial g}{\partial x_j}(p') \cdot \hat{v}_j}{\frac{\partial f}{\partial x_i}(p_0)} = -\dfrac{\frac{\partial f}{\partial x_n}(p_0 ) \cdot v_n}{\frac{\partial f}{\partial x_i}(p_0)}
        \]
        Thus the total derivative is given by
        \[
            - \frac{1}{\frac{\partial f}{\partial x_i}(p_0)}\sum_{j \in \{1, ..., i-1, i+1, ..., n\}}\frac{\partial f}{\partial x_j}(p_0) \cdot v_j
        \]
        Recall that \(\sum\limits_{j=1}^n \dfrac{\partial f}{\partial x_j}(p_0) \cdot v_j = \nabla f(p_0) \cdot \vec{v} = 0\). Using this, our expression for the total derivative at \(t = 0\) becomes
        \[
            - \frac{1}{\frac{\partial f}{\partial x_i}(p_0)} \cdot \left( -\frac{\partial f}{\partial x_i} (p_0) \cdot v_i \right) = v_i
        \]
        Therefore, we conclude that
        \[
            \alpha' (0) = (v_1, ..., v_{i-1}, v_i, v_{i+1}, ..., v_n) = \vec{v},
        \]
        Which verifies that \(\vec{v}\) is indeed a tangent vector to \(M\) at \(p_0\), finishing the proof.

        \medskip

        \noindent(b):

        Let \(f: \mathbb{R}^3 \to \mathbb{R}\) be a function defined by
        \[
            f(x,y,z) = x^2 + yz + y^2 - xy -xz + z^2 - 3
        \]
        The gradient of \(f\) is
        \[
            \nabla f(x,y,z) = (2x - y - z, z + 2y - x, y - x + 2z)
        \]
        and its zero set is exactly \(M\).
        
    \end{question}
	\newpage
	\begin{question}{33}
		\begin{enumerate}[label=(\alph*)]
            \item Let $g:U\rightarrow \R$ be a $C^1$ function defined on an open set $U\subseteq \R^n$, and let $M$ be its zero set:
                \[ M = \{ p\in U : g(p)=0 \}. \]
            Suppose that we have a $C^1$ function $f:U\rightarrow \R$, defined on an open set $U\subseteq \R^n$ which contains $M$, and we wish to find the maximum of $f$ on $M$. Assume that $M$ is compact, and that $f$ achieves its maximum on $M$ at some point $p_0\in M$. Prove that there exists a real number $\lambda \in \R$ such that
                \[ \nabla f(p_0) = \lambda \nabla g(p_0). \]
            This number $\lambda$ is known as the \textbf{Lagrange multiplier}.
    
            \item Use Lagrange multipliers to solve the following optimization problem: \textit{Find the point(s) on the ellipsoid $x^2 + yz + y^2 - xy - xz + z^2 = 3$ which are \textbf{closest} and \textbf{furthest} from the origin.}
        \end{enumerate}
	\end{question}
    \newpage
    \begin{question}{34}
        Let $\Phi:\R^n\rightarrow\R^m$ be a $C^1$ mapping.
        \begin{enumerate}[label=(\alph*)]
            \item Suppose that $n>m$. Show that $\Phi$ cannot be injective.
            
            \item Suppose that $n<m$. Show that if $K\subseteq\R^n$ is a compact set, then $\Phi(K)$ is a Jordan measurable set, and has Jordan measure zero.
        \end{enumerate}
        \tcblower
        \ 
        
        (a):

        
    \end{question}
\end{document}